@model PVI_ProyectoFinal.Models.ModelCobro
@{
    ViewBag.Title = "Gestionar Cobro";
}

<h2>Gestionar Cobro</h2>

<form method="post" id="cobroForm">
    @Html.HiddenFor(model => model.Id)

    <div class="mb-3">
        <label class="form-label" for="IdCasa">Casa:</label>
        <select id="IdCasa" name="IdCasa" class="form-control">
            <option value="">Seleccione una casa</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label" for="Mes">Mes:</label>
        @Html.TextBoxFor(model => model.Mes, new { placeholder = "Mes", type = "number", min = "1", max = "12", @class = "form-control" })
    </div>

    <div class="mb-3">
        <label class="form-label" for="Anno">Año:</label>
        @Html.TextBoxFor(model => model.Anno, new { placeholder = "Año", type = "number", min = "2024", max = "2034", @class = "form-control" })
    </div>

    <div class="mb-3">
        <label class="form-label" for="Monto">Monto:</label>
        @Html.TextBoxFor(model => model.Monto, new { placeholder = "Monto", type = "number", step = "0.01", @class = "form-control" })
    </div>

    <div class="mb-3">
        <label class="form-label" for="ServiciosSeleccionados">Servicios:</label>
        <select id="ServiciosSeleccionados" name="ServiciosSeleccionados" multiple="multiple" class="form-control">
        </select>
    </div>

    <input type="submit" class="btn btn-primary" value="Guardar Cobro" />
</form>

@section Scripts {
    <script type="text/javascript">
        // Function to load dropdown data
        function loadDropdown(url, ddl, selected) {
            $.ajax({
                url: url,
                dataType: 'json',
                type: 'GET',
                success: function (data) {
                    ddl.empty();
                    ddl.append("<option value=''>Seleccione una opción</option>");
                    $(data).each(function () {
                        var option = new Option(this.Nombre, this.Id);
                        if (this.Id == selected) {
                            option.selected = true;
                        }
                        ddl.append(option);
                    });
                },
                error: function (jQxhr, textStatus, errorThrown) {
                    console.error(errorThrown);
                }
            });
        }

        // Initialize dropdowns on document ready
        $(document).ready(function () {
            var idCasa = @(Model != null && Model.IdCasa != 0 ? Model.IdCasa.ToString() : "null");

            // Load Casas
            loadDropdown('/Condominio/GetCasas', $('#IdCasa'), idCasa);

            // Load Servicios
            loadDropdown('/Condominio/GetServicios', $('#ServiciosSeleccionados'), null);
        });
    </script>
}
